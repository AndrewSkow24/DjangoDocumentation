# Глава 2. Приступая к работе

Новичок в Django? Или вообще в веб-разработке? Хорошо, вы пришли
в правильное место: прочитайте этот материал, чтобы встать и побежать.

## 2.1. Первый взгляд на Django 

Так как Django был разработан в быстроменяющейся среде, он разработан 
для того, чтобы сделать частые задачи разработки быстро и легко. Это 
неформальный обзор как написать с помощью Django веб-приложение управления 
базой данных. 

Цель данного документа - дать вам достаточно технических спецификаций, 
чтобы понять, как Django работает, но мы не намереваемся создать руководство или 
документацию - мы совместим в одном. Когда вы будете готовы создать проект, вы можете начать с 
руководства или погрузиться глубже в более детальную документацию. 

### 2.1.1 Разработайте свою модель

Также вы можете использовать Django без базы данных с помощью 
объектно-реляционного преобразователя (ORM), в котором вы описываете вашу 
базу данных кодом Python. 

Синтаксис данных модели предлагает очень богатые возможности представления 
вашей модели - до сих пор это решало многолетнюю проблему схемы базы данных. 
Вот краткий пример: 

#### Листинг 1. news/models.py


```python

from django.db import models

class Reporter(models.Model):
    full_name = models.CharField(max_length=70)
    
    def __str__(self):
        return self.full_name
    
class Article(models.Model):
    pub_date = models.DateField()
    headline = models.CharField(max_length=200)
    content = models.TextField()
    reporter = models.ForeignKey(Reporter, on_delete=models.CASCADE)
    
    def __str__(self):
        return self.headline

```


### 2.1.2 Установите это 

Далее запустите Django-утилиту через командную строку, чтобы создать базу 
данных автоматически

```bash
python3 manage.py makemigrations
python3 manage.py migrate
```

Команда `makemigrations` проверяет все ваши доступные модели и создаёт 
миграции все таблицы для каждой модели. `migrate` запускает миграции и создаёт 
таблицы в вашей базе данных, а также опционально обеспечивает намного более гибкий контроль

### 2.1.3 Насладитесь свободным API

Вместе с тем, вы получаете свободный и богатый доступ к вашим данным 
с помощью Python API. API создаётся на лету, в генерации кода нет необходимости.

```bash
(.venv) andrejskovorodnikov@MacBook-Air-Andrej get_started % python3 manage.py shell
8 objects imported automatically (use -v 2 for details).
                                                                              
Python 3.11.3 (v3.11.3:f3909b8bc8, Apr  4 2023, 20:12:10) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
>>> # Импортируем созданные модели из приложения "app"
>>> from news.models import Article, Reporter
>>> # Ни одного репортёра ещё нет в системе
>>> Reporter.objects.all()
<QuerySet []>
>>> # Создаём нового репортёра 
>>> r = Reporter(full_name = "John Smith")
>>> # Сохраняем объект в базу данные. Мы явно вызываем save(). 
>>> r.save()
>>> # Теперь у нас есть id
>>> r.id
1
>>> # Теперь репортёр в базе данных 
>>> Reporter.objects.all()
<QuerySet [<Reporter: John Smith>]>

>>> # Django предоставляет богатый API для поиска в базе данных
>>> Reporter.objects.get(id=1)
<Reporter: John Smith>
>>> Reporter.objects.get(full_name__startswith="John")
<Reporter: John Smith>
>>> Reporter.objects.get(full_name__contains="mith")
<Reporter: John Smith>
>>> Reporter.objects.get(id=2)
Traceback (most recent call last):
  File "<console>", line 1, in <module>
  File "/Users/andrejskovorodnikov/PycharmProjects/DjangoDocumentation/.venv/lib/python3.11/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andrejskovorodnikov/PycharmProjects/DjangoDocumentation/.venv/lib/python3.11/site-packages/django/db/models/query.py", line 633, in get
    raise self.model.DoesNotExist(
news.models.Reporter.DoesNotExist: Reporter matching query does not exist.

>>> # Создание статьи 
>>> from datetime import date
>>> a=Article(pub_date=date.today(), headline="Django is cool", content="Yeah.", reporter=r)
>>> a.save()
>>> # теперь статья в базе данных
>>> Article.objects.all()
<QuerySet [<Article: Django is cool>]>

>>> # Объект статьи даёт с помощью API доступ к связанному объекту репортёра
>>> r = a.reporter
>>> r.full_name
'John Smith'

>>> # и наоборот объект репортёра даёт доступ к объекту статьи 
>>> r.article_set.all()
<QuerySet [<Article: Django is cool>]>


>>> # Можно изменить объект и вызвать save()
>>> r.full_name="Billy Goat"
>>> r.save()


>>> # Api следует за связями так далеко, как вам нужно, повышая эффективность и работая за сценой
>>> Article.objects.filter(reporter__full_name__startswith="Billy")
<QuerySet [<Article: Django is cool>]>

>>> # Удаление объекта с помощью delete()
>>> r.delete()
(2, {'news.Article': 1, 'news.Reporter': 1})

>>> exit()

```

### 2.1.4. Динамический интерфейс админа, это не просто строительные материалы, это целый дом 

Когда ваша модель определена, Django может автоматически создать профессиональный 
готовый административный интерфейс - вебсайт, позволяющий аутентифицировать 
пользователей, добавлять, изменять и удалять объекты. Только один шаг 
требуется, чтобы зарегистрировать модель на админском сайте? 

#### Листинг 2. news/models 

```python
from django.db import models


class Article(models.Model):
    pub_date = models.DateField()
    headline = models.CharField(max_length=200)
    content = models.TextField()
    reporter = models.ForeignKey(Reporter, on_delete=models.CASCADE)
```

#### Листинг 3. news/admin.py

```python
from django.contrib import admin

# Register your models here.
from . import models

admin.site.register(models.Article)
```

```bash
python3 manage.py createsuperuser
```

Здесь философия в том, что ваш сайт редактируется персоналом или 
клиентом, а может быть просто вами, и вы не хотите иметь дело с 
созданием бэкенд-интерфейса только для управления контентом. 

Один типичный рабочий процесс в создании Django-приложения - это
создание модели и получения администраторского сайта так быстро, насколько 
это возможно, таким образом чтобы ваш персонал или клиенты могли начать 
заполнять данные. Затем разработчики могли найти способ представить 
их публике. 

### 2.1.5 Создайте свои URLы

Чистая, элегантная схема URL - важная деталь в высококачественном веб-приложении. 
Django поощряет красивый дизайн URL и не добавляет никакого хлама в 
URL вроде `.php` или `.asp`.

Чтобы разработать систему URL для приложения, вы создаёте Python-модуль 
называемый `URLconf`. Таблица контента будет содержать связь между паттернами URL и 
Python колбэк-функциями. URLconfs будет обслуживать развязку урлов 
из Python-кода. 

Вот как может выглядеть `URLconfs` для `Report/article` выше

```python
from django.urls import path

from . import views


urlpatterns = [
    path("articles/<int:year>/", views.year_archive),
    path('articles/<int:year>/<int:month>/', views.month_archive),
    path("article/<int:pk>/", views.article_detail, name='detail'),
]


```

Код выше устанавливает соответствие между URL и колбэк-функциями из `view`.
Строка использует параметрические теги, чтобы захватить значения из URL. 
Когда пользователь запрашивает страницу джанго идёт по проходит по 
каждому пути по порядку и останавливается на первом соответствии. 
Если ничего не нашлось джанго выдаст ошибку 404. Это чрезвычайно быстро
поскольку пути построены на регулярных выражениях во время загрузки. 

Когда будет найден соответствующий url-паттерн, джанго вызовет соотвтетсвующий view, 
который является питон-функцией. Каждая такая питон-функция проходит 
запрос запрос вместе с содержащимися в запросе метаданными и значениями, 
захваченными из паттерна. 

Для примера, если пользователь запросил “/articles/2005/05/39323/, джанго 
вызовет `news.views.article_detail(request, year=2025, month=5, pk=39323)`.

### 2.1.6. Создайте ваши представления (view)

Каждое представление (view) за одну из 2 вещей: Возврат `HttpResponse`
объекта, содержащего контент запрашиваемой страницы или генерирование 
исключения, такого как `Http404`. 

В общем, view извлекает данные, согласованные с параметрами, грузит шаблон 
и рендерит шаблон с извлечёнными данными. Вот пример для `year_archive выше`

#### Листинг 5: news/views.py

```python
from django.shortcuts import render
from django.template.context_processors import request

from .models import Article

# Create your views here.

def year_archive(request, year):
    a_list = Article.objects.filter(pub_date__year=year)
    print(a_list)
    context = {"year": year, "article_list": a_list}
    return render(request, 'news/year_archive.html', context)

def month_archive(request, year, month):
    a_list = Article.objects.filter(pub_date__year=year, pub_date__month=month)
    content = {
        "year": year,
        "month": month,
        "article_list": a_list
    }
    return render(request, 'news/year_month_archive.html', content)

def article_detail(request, pk):
    article = Article.objects.filter(pk=pk)
    content = {
        "pk": pk,
        "article": article
    }
    return render(request, 'news/details.html', content)
```

Этот пример использовал Django систему шаблонов, мощную вещь возможность,
но стремится остаться достаточным, чтобы его использовали не программисты.

### 2.1.7 Разработка шаблонов 

Код выше грузил `news/year_archive.html` шаблон. 

В Джанго есть шаблонный поиск пути, который позволяет минимизировать 
избыточности между шаблонами. В ваших настройках джанго, вы указываете 
список директорий, чтобы проверять шаблон вместе с `DIRS`. Если 
шаблон не существует в первой директории, проверяется вторая and so on. 

#### Листинг 6. news/templates/news/year_archive.html 

```html
{% extends "base.html" %}

{% block title %}Articles for {{ year }} {% endblock %}

{% block content %}
<h1>Articles for {{ year }}</h1>

{% for article in article_list %}
    <p>{{ acricle.headline }}</p>
    <p>{{ article.reporter.full_name }}</p>
    <p>Published: {{ article.pub_date|date:"F j, Y" }}</p>
    <a href='{% url "detail" article.pk %}'>Читать статью</a>
{% endfor %}

{% endblock %}
```

Переменные окружены двойными фигурными скобками `{{ article.headline }}`, 
означающая "Отдай значение атрибута заголовка статьи". Но точка используется 
не используется только для просмотра атрибута. Она также используется для 
просмотра значения в словаре по ключу, просмотр по индексу и вызов функций. 

Запись `{{ article.pub_date|date:"F j, Y" }}` использует Unix-стиль "палочку" 
(символ `|`). Это называется шаблонным фильтром, с помощью которого можно 
отфильтровать значение переменной. В этом случает, фильтр даты форматирует 
питоновский datetime-объект в требуемый формат(известную как PHP функцию `date`).

По цепочке вы можете добавить сколько угодно фильтров. Вы можете написать 
кастомный шаблонный фильтр, который запустит кастомный код питона за сценой. 

Наконец, Джанго использует концепт наследования шаблонов. Вот что делает 
`{% extends "base.html" %}`. Это означает: "Найди шаблон с именем `base`, который 
определён в куче блоков и заполни блоки соответствующими блоками. Вкратце, 
это позволяет вам значительно сократить шаблоны, каждый шаблон должен быть 
определён только уникальным для того базового шаблона. 

Вот как выглядит `base.html` шаблон, включая статические файлы, может быть 
что-то вроде этого: 

#### Листинг 7: templates/base.html 

```html
{% load static %}
<html lang="en">
<head>{% block title %}{% endblock %}</head>
<body>
    <img src="{% static 'images/sitelogo.png' %}" alt="Logo">
    {% block content %}{% endblock %}
</body>
</html>
```

Упрощённо это определяет как будет выглядеть и ощущаться сайт (вместе со своим логотипом),
и определяет свободные места для дочерних шаблонов. Создатели Django 
использовали эту технику, чтобы создать поразительно отличающиеся мобильную 
версию сайтов только создав новый базовый шаблон. 

Заметьте, что вы не обязаны использовать систему шаблонов джанго, если 
вы предпочитаете другую систему. В то время как Django система шаблонов в частности 
хорошо интеррированы с уровенем моделей джанго. По этой причине, вы 
не обязаны использовать также API базы данных. Вы можете использовать 
другую абстракцию базы данных, вы можете читать XML-файлы, вы можете 
читать файлы с диска и что-то ещё, что захотите. Каждая часть Django: 
модели, представления (view) - об этом по отдельности дальше. 

### 2.1.8 Это было просто поверхностно 

Это все было быстрое поверхностное описание функционала джанго. 
Некоторые другие полезные возможности: 

- фреймворка кешинга, который интегрируется с памятью кэша или с другм бэкендом 

- syndication фреймворк, который позволят создавать RSS и Atom новостные ленты 

- больще привлекательных автоматически сгенерированных админастраторских возможностей - это поверхностное описание возможностей 

Следующий шаг для вас - скачать Django, прочитать руководство и присоединиться 
к сообществу. Спасибо за ваш интерес. 

## 2.2. Быстрый гид по установке 

Перед тем как использовать джанго, вам нужно его установить. У нас есть полный гид 
по установке, который покрывает все возможные способы. Гид, который вы 
читаете сейчас даст вам минимальную установку, которая будет работать, 
пока вы изучаете введение. 

### 2.2.1. Установка Питона 

Являясь веб-фреймворком Python, джанго требует питона. Смотрите подробнее: какую 
версию питона я могу использовать с Джанго для подробностей. Python включает 
легковесную базу данных, называемую SQLite, так что вам не нужно пока устанавливать 
базу данных. 

Получите последнюю версию Питона https://www.python.org/downloads/ или 
с помощью пакетного менеджера вашей операционной системы 

Вы должны должны убедиться, что ваш питон установлен, набрав `python` в вашей оболочке (терминале), вы должны увидеть что-то вроде этого

```bash
Python 3.11.3 (v3.11.3:f3909b8bc8, Apr  4 2023, 20:12:10) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
```

### 2.2.2. Настройте базу данных 

Этот шаг необходим, если вы хотите работаться с большими базами данных вроде PostgreSQL, MariaDB, MySQL или Oracle. Как установить базу данных проконсультируйтесь `установочная информация по базам данных`. 

### 2.2.3. Установка Django 

У вас есть три способа установить Django: 

- Установить официальный релиз. Это лучший подход для большинства пользователй. 
-Установить версию джанго, которая обеспечена дистрибутивом вашей операционной системы. 
- Установить последнюю версию разработчиков. Это вариант для энтузиастов, которые хотять последние и лучшие возможности и не боятся совершенно нового кода. Вы можете столкнуться с новыми багами в девелоперских версиях (они для разработчиков), но сообщение о них поможет разработчикам Django. Также сторонние релизы менее совместимы с версиями для разработчиков, чем последний стабильный релиз 

**Всегда обращайтесь к документации, которая соответствует версии Django, которую вы используете.**

Если вы делаете любой из двух шагов, держите перед глазами часть документации, где помечены новые в разработке вещи. Эта фраза отмечает возможности, которые доступны только в девелоперских версих django, и они не будут работать в официальном релизе. 

### 2.2.4. Верификация 

Чтобы верифицировать что питон может видеть джанго, напишите `python` в вашей оболчке. Затем попросите питон импортировать джанго

```bash
>>> import django
>>> print(django.get_version())
5.2.6
```

У вас может быть другая установленная версия Django. 

### 2.2.5 То что надо 

То, что надо, вы можете перейти к руководству.

## 2.3. Напишите ваше первое Django приложение, часть 1

Давайте изучим пример. 

По окончании этого руководства, вы сможете создать базовое приложение для опроса. 

Оно будет содержать две части: 

- Публичный сайт, который позволит людям видеть опросы и заполнять их
- Администраторский сайт, который позволит вам добавлять, менять и удалять опросы. 

Мы будем предполагать, что джанго у вас уже установлено. Вы можете сказать, что джанго установлено и какая версия, запустив следующую команду сделав следующий запрос в командной строке (указав префикс $)

```bash
python -m django --version
5.2.6
```

Если Django установлено, вы должны увидеть версию установленного джанго. Если это не так, вы увидите ошибку, говорящую, что "Нет модуля с именем django"